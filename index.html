<!DOCTYPE html>
<html lang="en">
  <head>
    <title>WebXR YouTube + Punching Orbs</title>
    <meta name="description" content="Watch YouTube in VR and punch orbs!">
    <meta charset="utf-8" />

    <!-- A-Frame Core -->
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    
    <!-- For convenience, weâ€™ll inline some scripts. In production, put them in separate .js files. -->
    <script>
      // Simple component to handle "punching" detection via distance checks
      AFRAME.registerComponent('punchable-orb', {
        schema: {
          speed: {type: 'number', default: 0.001}, // movement speed
        },
        init: function () {
          this.direction = new THREE.Vector3(
            (Math.random() - 0.5) * 2,
            (Math.random() - 0.5) * 2,
            (Math.random() - 0.5) * 2
          ).normalize();
          this.punched = false;
        },
        tick: function (time, timeDelta) {
          // Move the orb around
          let pos = this.el.object3D.position;
          let delta = timeDelta * this.data.speed;
          pos.addScaledVector(this.direction, delta);

          // Check distance from controllers
          const hands = document.querySelectorAll('[hand-controls], [tracked-controls]');
          hands.forEach(hand => {
            const handPos = hand.object3D.position;
            const dist = pos.distanceTo(handPos);
            if (dist < 0.15 && !this.punched) {
              this.onPunched();
            }
          });
        },
        onPunched: function() {
          this.punched = true;
          // Create a quick "pop" effect
          this.el.setAttribute('visible', false);
          // Remove from scene after a short delay
          setTimeout(() => {
            this.el.parentNode.removeChild(this.el);
          }, 100);
        }
      });

      // Spawner component to randomly create orbs around the user
      AFRAME.registerComponent('orb-spawner', {
        schema: {
          interval: {type: 'number', default: 2000} // spawn every 2 seconds
        },
        init: function() {
          this.lastSpawnTime = 0;
        },
        tick: function(time, timeDelta) {
          if (time - this.lastSpawnTime > this.data.interval) {
            this.spawnOrb();
            this.lastSpawnTime = time;
          }
        },
        spawnOrb: function() {
          const orb = document.createElement('a-sphere');
          // Random position around the origin
          const range = 2.5;
          const x = (Math.random() - 0.5) * range * 2;
          const y = Math.random() + 1; // a bit above ground
          const z = (Math.random() - 0.5) * range * 2;
          orb.setAttribute('position', {x, y, z});
          orb.setAttribute('radius', 0.1);
          orb.setAttribute('color', '#'+(Math.random()*0xFFFFFF<<0).toString(16));
          orb.setAttribute('punchable-orb', 'speed: 0.3'); 
          this.el.sceneEl.appendChild(orb);
        }
      });
    </script>
  </head>
  <body>
    <a-scene vr-mode-ui="enabled: true" embedded>
      <!-- Enable WebXR -->
      <a-entity xr="local-floor: true"></a-entity>

      <!-- Camera + Controllers -->
      <a-entity camera look-controls position="0 1.6 0"></a-entity>
      <!-- Basic hand controllers (Quest, Vive, etc.). If no controllers, fallback is "hands" -->
      <a-entity laser-controls="hand: right"></a-entity>
      <a-entity laser-controls="hand: left"></a-entity>

      <!-- Add a floor for reference -->
      <a-plane rotation="-90 0 0" width="10" height="10" color="#222"></a-plane>

      <!-- A floating "screen" where we embed YouTube via <iframe> -->
      <!-- For simplicity, this example uses A-Frame's DOM overlay method 
           or the "HTML Shader" approach. If that doesn't work in your environment, 
           consider placing the <iframe> in a 2D overlay. -->
      <a-entity id="video-screen" position="0 2 -2">
        <a-plane 
          id="video-plane" 
          width="1.78" 
          height="1" 
          color="#000"
          material="shader: flat;"
        >
          <!-- 
            Some approaches use <a-plane> with a "html texture" shader, but
            it can be tricky due to cross-domain or performance issues.
            Alternatively, you can float a DOM element in front of the user 
            or use a library like 'aframe-html-shader'.
          -->
        </a-plane>

        <!-- A simple 2D button to start/pause video via the YouTube iframe API (optional for demonstration) -->
        <a-box id="play-button" color="#4CAF50" depth="0.02" height="0.2" width="0.4" position="0 -0.8 0"
               event-set__enter="_event: mouseenter; material.color: #8BC34A"
               event-set__leave="_event: mouseleave; material.color: #4CAF50"
               text="value: Play/Pause; align: center; color: #FFF; width: 2"
        ></a-box>
      </a-entity>

      <!-- Orb spawner to create orbs around the user -->
      <a-entity orb-spawner="interval: 3000"></a-entity>
    </a-scene>

    <!-- The actual IFrame for YouTube placed as an overlay in the DOM (CSS pinned near the VR view).
         Alternatively, use a library to map it onto a 3D plane if you want it fully in-world. -->
    <div id="youtube-overlay" style="
         position: absolute; 
         top: 50px; left: 50%;
         transform: translateX(-50%);
         width: 640px; height: 360px;
         border: 2px solid #CCC; background: #000;">
      <iframe id="youtube-player" 
              width="640" 
              height="360"
              src="https://www.youtube.com/embed/dQw4w9WgXcQ?enablejsapi=1&playsinline=1"
              frameborder="0"
              allowfullscreen
      ></iframe>
    </div>

    <script>
      // Basic YouTube IFrame API integration:
      let player;
      window.onYouTubeIframeAPIReady = function() {
        player = new YT.Player('youtube-player', {
          events: {
            'onReady': onPlayerReady,
          }
        });
      };
      function onPlayerReady(event) {
        console.log('YouTube Player is ready.');
      }

      // Load YouTube IFrame API script
      var tag = document.createElement('script');
      tag.src = "https://www.youtube.com/iframe_api";
      var firstScriptTag = document.getElementsByTagName('script')[0];
      firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

      // Toggle play/pause when the "Play/Pause" box is clicked in VR
      document.querySelector('#play-button').addEventListener('click', () => {
        if (player && player.getPlayerState) {
          let state = player.getPlayerState();
          if (state === YT.PlayerState.PLAYING) {
            player.pauseVideo();
          } else {
            player.playVideo();
          }
        }
      });
    </script>
  </body>
</html>
